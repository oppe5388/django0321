{% extends 'layout.html' %}
{% load static %}
{% block title %}FAX当番{{disp_day}}{% endblock %}

{% block extra_head %}
<!-- CSS -->
<link href="{% static 'jquery-sortable.css' %}" rel="stylesheet" type="text/css">
{% endblock %}

{% block content %}

{% if messages %}
		{% for message in messages %}
			<div class="alert{% if message.tags %} alert-{{ message.tags }}{% endif %}" role="alert">{{ message }}</div>
		{% endfor %}
{% endif %}

<div class="card">
	<div class="d-flex">
		<!-- 日付と前後ボタン -->
		<a href="{% url 'myinfo:fax' yesterday %}" class="btn btn-secondary btn-sm mb-2">
			<i class="fas fa-chevron-left"></i>前日</a>
		<div class="col-3 text-center" id="target_date">{{disp_day}}</div>
		<a href="{% url 'myinfo:fax' next %}" class="btn btn-secondary btn-sm mb-2">
			翌日<i class="fas fa-chevron-right"></i></a>

		<button class="btn btn-secondary btn-sm mb-2 ml-auto" id="edit_expand"><i class="fas fa-edit fa-xs"></i></button>
	</div>
	<hr class="mt-0">
	<!-- データ表示 -->
	<div id="disp_block">
		{{ fax.html|safe }}
	</div>
	<!-- 編集画面：当日があれば当日編集、なければ前日を初期表示する -->
	<div class="bg-gray-300" id="edit_block">
		{% if fax.html %}
			{% comment %} {{ disp_day}}の編集 {% endcomment %}
			{{ fax.html|safe }}
		{% elif yesterday_fax.html %}
			{% comment %} {{ yesterday }}を元に新規作成 {% endcomment %}
			{{ yesterday_fax.html|safe }}
		{% else %}
			{% comment %} 新規作成 {% endcomment %}
			<div class="d-flex">
				<div class="d-flex flex-column col">
				<h5 class="row ohiru mx-auto px-1">　</h5>
				<ul class='example block connect-area px-1'>
					<li><ul class="op">坂入
						<li><ul class="kakari">相殺</ul></li>
					</ul></li>
					<li><ul class="op">菅原</ul></li>
				</ul>
				</div>
				<div class="d-flex flex-column col">
				<h5 class="row ohiru mx-auto px-1">11:40〜12:30</h5>
				<ul class='example block connect-area px-1'>
					<li><ul class="op">御園
						<li><ul class="kakari">リスト</ul></li>
						<li><ul class="fax">09:30〜</ul></li>
						<li><ul class="fax">12:30〜</ul></li>
						<li><ul class="fax">15:30〜</ul></li>
					</ul></li>  
				</ul>
				</div>
				<div class="d-flex flex-column col">
				<h5 class="row ohiru mx-auto px-1">12:00〜12:50</h5>
				<ul class='example block connect-area px-1'>
				</ul>
				</div>
				<div class="d-flex flex-column col">
				<h5 class="row ohiru mx-auto px-1">12:30〜13:20</h5>
				<ul class='example block connect-area px-1'>
					<li><ul class="op">市川
						<li><ul class="kakari">U直</ul></li>
						<li><ul class="fax">10:30〜</ul></li>
						<li><ul class="fax">13:30〜</ul></li>
						<li><ul class="fax">17:30〜</ul></li>
					</ul></li>
				</ul>
				</div>
				<div class="d-flex flex-column col">
				<h5 class="row ohiru mx-auto px-1">13:20〜14:10</h5>
				<ul class='example block connect-area px-1'>
					<li><ul class="op">藤岡
						<li><ul class="kakari">名変</ul></li>
						<li><ul class="fax">11:30〜</ul></li>
						<li><ul class="fax">14:30〜</ul></li>
						<li><ul class="fax">16:30〜</ul></li>
						<li><ul class="fax">18:30〜</ul></li>
					</ul></li>
				</ul>
				</div>
			</div>
		
			<!-- 2行目 -->
			<div class="d-flex">
				<div class="d-flex flex-column col-3">
					<h5 class="row ohiru mx-auto px-1">LD</h5>
					<ul class='example block connect-area px-1'>
					<li><ul class="op">尾凪</ul></li>
					<li>
						<ul class="op">大磯
							<li><ul class="kakari">U直チェック</ul></li>
							<li><ul class="kakari">名変チェック</ul></li>
						</ul></li>
					<li><ul class="op">太田</ul></li>
					<li><ul class="op">木下</ul></li>
					</ul>
				</div>
				<div class="d-flex flex-column col-3">
					<h5 class="row ohiru mx-auto px-1">休</h5>
					<ul class='example block connect-area px-1'>
						<li><ul class="op">福田</ul></li>
						<li><ul class="op">石嶋</ul></li>
					</ul>
				</div>
			</div>
		{% endif %}
	</div>
</div>



<!-- 新規はurl指定なしで保存、更新はurl指定 -->
<form method="post" id="form01" {% if fax.html %} action="{% url 'myinfo:fax_del_create' disp_day %}"{% endif %}>
	{% csrf_token %}
	{{ form.date }}
	{{ form.html }}
	
	<div class="d-flex justify-content-between">
		<button class="btn btn-secondary" id="cancel">キャンセル</button>
		{% if fax.html %}
		<a href="{% url 'myinfo:fax_delete' disp_day %}" class="btn btn-danger justify-content-between">削除</a>
		<input class="btn btn-info" type="submit" value="更新">
		{% else %}
			<input class="btn btn-primary" type="submit" value="保存">
		{% endif %}
	</div>
	<p class="small mt-2">※各ボタン、確認画面なしに実行されます</p>
</form>

<div class="row">
	<button type="button" class="btn btn-sm btn-secondary rounded-pill mb-2 ml-3" data-toggle="modal" data-target="#ModalCentercompany" id="company">午後休憩</button>
  
	<div class="modal fade" id="Modal2" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-scrollable modal-lg">
		  <div class="modal-content">
			  <div class="modal-header py-0">
				  <button type="button" class="close mt-0" data-dismiss="modal" aria-label="Close">
					  <span aria-hidden="true" >&times;</span>
				  </button>
			  </div>
			  <div class="modal-body pt-0">
				★3名
				<table class='table table-sm table-hover m-0'>
					<tr>
						<th>①</th>
						<td>15:00-15:20</td>
						<td>　</td>
						<td>1530</td>
						<td></td>
					</tr>
					<tr>
						<th>②</th>
						<td>15:20-15:40</td>
						<td>　</td>
						<td>　</td>
						<td></td>
					</tr>
					<tr>
						<th>③</th>
						<td>15:40-16:00</td>
						<td>1430</td>
						<td>　</td>
						<td></td>
					</tr>
				</table>

				  <table class='table table-sm table-hover m-0'>
					<thead class="table sticky-top thead-dark m-0">
					  <tr class="text-nowrap small">
						<th>NFS営業担当事務所</th>
						<th>販売会社</th>
						<th>お客様相談室</th>
						<th>緊急サポートダイヤル</th>
						<th>BC本部</th>
						<th>NFSメンテ</th>
						<th>自社メンテ</th>
					  </tr>
					</thead>
					<tbody id="myTable">
					  {% comment %} {% for dealer in faq.dealers.all %} {% endcomment %}
					  {% for dealer in dealers_set %}
						  <tr class="">
							<td class="align-middle pr-3 text-nowrap"><span class="small">{{ dealer.base }}</span><br>{{ dealer.base_tel }}</td>
							<td class="align-middle text-nowrap"><span class="small">{{ dealer.code5 }}</span><br>{{ dealer.name }}</td>
							<td class="align-middle text-nowrap">{{ dealer.customer_desk }}</td>
							<td class="align-middle text-nowrap">{{ dealer.emergency }}</td>
							<td class="align-middle small">{{ dealer.bc }}</td>
							<td class="align-middle small">{{ dealer.nfs }}</td>
							<td class="align-middle small">{{ dealer.in_house }}</td>
						  </tr>
					  {% endfor %}
					</tbody>
				  </table>
			  </div> 
		  </div>
	  </div>
	</div>

<textarea class="d-none" id="serialize_output"></textarea>

<!-- Javascript -->
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src='{% static 'jquery-sortable.js' %}'></script>
<script type="text/javascript">
	$(function() {
		// $("ul.example").sortable({
		// 	group: 'connect-area'
		// });
		
		$('#edit_block').hide();//最初は非表示
		$('#form01').hide();

		//編集画面を開くボタン
		$('#edit_expand').click(function() {
			$(this).hide();
			$('#disp_block').hide();
			$('#edit_block').fadeIn(500);
			$('#form01').fadeIn(500);
			$('#id_date').val($('#target_date').text());
		});

		//編集キャンセル
		$('#cancel').click(function() {
			$('#edit_block').hide();
			$('#form01').hide();
			$('#disp_block').fadeIn(500);
			$('#edit_expand').fadeIn(500);
		});

	});


	// 作り変え
	var group = $("ul.example").sortable({
	  group: 'connect-area',
	  onDrop: function ($item, container, _super) {
		// 挙動おかしくなるので必要
	    $('#serialize_output').val(
	      group.sortable("serialize").get().join("\n"));
	    _super($item, container);

		// 自作
		var str = $('#edit_block').html();
		str=str.replace(/\r?\n/g, '');// 改行削除
		//str=str.replace(/example/g, '');// sortable不可にするためクラス削除
		$('#id_html').val(str);
	
	  },
	  // 挙動おかしくなるので必要
	  serialize: function (parent, children, isContainer) {
	    return isContainer ? children.join() : parent.text();
	  },
	});
	// 作り変えここまで

</script>


<!-- モーダルのために、Jqueryの後にBootstrap読み込みが必要？-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
<script>
  //販社モーダル
  $("#company").click(function () {
    $('#Modal2').modal('show')
  });

</script>

<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script> -->


{% endblock %}